# 键道词库转换器 (JD Dict Converter)

<div align="center">

[![Version](https://img.shields.io/badge/version-3.4-blue.svg)](https://github.com/yourusername/jd-dict-converter/releases)
[![License](https://img.shields.io/badge/license-MIT-green.svg)](LICENSE)
[![Python](https://img.shields.io/badge/python-3.7+-orange.svg)](https://www.python.org/)
[![Platform](https://img.shields.io/badge/platform-Windows-lightgrey.svg)](https://github.com/yourusername/jd-dict-converter)

**将拼音词库快速转换为键道输入法编码格式**

[特性](#特性) • [快速开始](#快速开始) • [使用教程](#使用教程) • [编码规则](#编码规则) • [更新日志](#更新日志)

</div>

---

## 📋 目录

- [简介](#简介)
- [特性](#特性)
- [快速开始](#快速开始)
- [使用教程](#使用教程)
- [排序工具](#排序工具)
- [常见问题](#常见问题)
- [开源协议](#开源协议)

---

## 简介

键道词库转换器是一款专为**键道输入法**设计的词库转换工具。它能够将拼音词库快速转换为键道编码格式，支持 Rime 输入法框架。

### 适用场景

- 从搜狗、QQ 等拼音输入法导出词库后转换为键道格式
- 批量生成键道词库编码
- 合并多个词库并自动去重
- 对现有键道词库进行补充和优化

---

## 特性

### ✨ 核心功能

- **🚀 高性能转换**: 平均 1 万词约 10 秒，支持百万级词库
- **📝 混合格式支持**: 支持纯词组或词组+编码混合输入
- **🔄 智能去重**: 自动识别并排除已有词库中的重复词条
- **📊 智能编码顺延**: 当编码被占用时自动向长码推移
- **🎯 保持顺序**: 严格保持 All.txt 的原始顺序
- **✈️ 飞键支持**: 自动处理含 uang 音节的双编码（m/x 变体）

### 🎨 特色功能

- **混合输入格式**: 同时支持纯词组和"词组\t编码"两种格式
- **双编码补全**: 自动为飞键词组生成 m 和 x 两个变体
- **智能重码处理**: 允许重码存在，由输入法按词频排序
- **区域过滤**: 自动跳过 #region <简字> 等特定区域
- **BOM 编码处理**: 正确处理 UTF-8-SIG 编码，避免顺序错乱

### 📦 辅助工具

- **排序工具**: 支持按编码、词组长度、编码长度等多种方式排序
- **批处理脚本**: 一键运行，无需手动操作
- **自动备份**: 排序前自动备份原文件

---

## 快速开始

### 方式一: 使用预编译版本（推荐）

1. **下载程序**

   前往 [Releases](https://github.com/yourusername/jd-dict-converter/releases) 页面下载最新版本的 `键道编码转换.exe`

2. **准备文件**

   在 exe 文件所在目录准备以下文件：
   - `All.txt` - 你的词组文件（每行一个词组）
   - 放入需要排除的码表.dict.yaml文件
   
3. **运行转换**

   双击 `键道编码转换.exe` 或 `运行转换.bat`

4. **获取结果**

   在同目录下找到 `result.dict.yaml` 即为转换结果

### 方式二: 使用 Python 源码

```bash
# 1. 克隆仓库
git clone https://github.com/yourusername/jd-dict-converter.git
cd jd-dict-converter

# 2. 安装依赖
pip install pypinyin

# 3. 运行转换
python py2jd.py
```

---

## 使用教程

### 📝 准备输入文件

#### All.txt 格式说明

支持两种格式，可混用：

**格式 1: 纯词组**
```
键道输入法
天行键
星猫键道
```

**格式 2: 词组+编码**
```
键道输入法	jdef
天行键	txj
星猫键道	xmjd
```

> 💡 **提示**: 使用格式 2 时，程序会自动提取词组部分，忽略原有编码

#### All.txt 编码要求

- **编码格式**: UTF-8-SIG (带 BOM)
- **每行一词**: 不要有空行
- **制表符**: 词组和编码之间使用 Tab 键分隔

### 🚀 执行转换

#### Windows 用户

**方法 1: 双击运行**
```
双击 键道编码转换.exe
```

**方法 2: 使用批处理**
```
双击 运行转换.bat
```

#### Python 用户

```bash
python py2jd.py
```

### 📊 查看结果

转换完成后，会在同目录生成：

- **result.dict.yaml** - 最终的键道词库文件
- **中间文件** (可选删除):
  - pinyin.csv - 拼音注音结果
  - jdy.csv / jdyf.csv - 标准/飞键编码
  - jdAll.csv / jdAllx.csv - 音形码合并结果
  - 已有字词.txt / 已有编码.txt - 从现有词库读取的内容

### 🔀 可选: 排序结果

如果需要对结果进行排序：

```
双击 排序工具.bat
```

提供 4 种排序方式：
1. 按编码排序 (a-z 字母顺序)
2. 按词组长度排序 (从短到长)
3. 按编码长度排序 (3码→4码→5码→6码)
4. 按词组排序 (拼音顺序)

> ⚠️ **注意**: 排序会自动备份原文件为 `result.dict.yaml.backup`

---

## 排序工具

### 使用方法

1. 运行 `排序工具.bat` 或 `python sort_result.py`
2. 选择排序方式（输入 1-5）
3. 自动备份并完成排序

### 排序选项

| 选项 | 说明 | 适用场景 |
|-----|------|---------|
| 1. 按编码排序 | a-z 字母顺序 | 方便查找特定编码 |
| 2. 按词组长度排序 | 短词在前 | 优先匹配短词 |
| 3. 按编码长度排序 | 短码在前 | 优先使用短码 |
| 4. 按词组排序 | 拼音顺序 | 按拼音查找词组 |

---

## 高级功能

### 🔄 智能去重

程序会自动识别当前目录下所有 `.dict.yaml` 文件，并：

- ✅ 读取已有的"词组\t编码"组合
- ✅ 排除重复词组，避免冲突
- ✅ 检查编码占用，智能顺延

### 🎯 智能重码处理

当所有码位都被占用时：

- 新词自动补充到 6 码位置
- 允许重码存在
- 输入法会按词频排序候选项

### 🏷️ 区域过滤

自动跳过包含"简"的 #region 区域：

```yaml
#region <简字>
  # 这部分内容会被跳过
#endregion
```

---

## 常见问题

### ❓ 转换后的文件顺序不对？

**原因**: All.txt 文件编码不正确

**解决**:
1. 用记事本打开 All.txt
2. 另存为 → 编码选择 "UTF-8"（带 BOM）
3. 重新运行转换

### ❓ 为什么有些词的编码是 6 码？

这是正常的。当短码被占用时，程序会自动向长码推移，确保每个词都有编码。

### ❓ 如何避免重复词组？

将现有的 `.dict.yaml` 文件放在同一目录下，程序会自动识别并排除重复词组。

### ❓ 生成的编码能直接用于 Rime 吗？

可以。生成的 `result.dict.yaml` 符合 Rime 词库格式，可以直接使用。

### ❓ 支持其他操作系统吗？

当前仅提供 Windows 版本的 exe。macOS 和 Linux 用户可以使用 Python 源码运行。

---

<div align="center">
**如果这个项目对你有帮助，请给一个 ⭐ Star 支持一下！**

Made with ❤️ by [Your Name]

</div>
